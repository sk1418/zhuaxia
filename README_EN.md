

[中文介绍](README.md)


####Table of contents
(toc is generated by [ghtoc](https://github.com/sk1418/ghtoc))
- [Introduction](#introduction)
- [Dependencies](#dependencies)
- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
	- [download xiami resource outside China](#proxy-setting)
- [Screenshots](#screenshots)
- [Change logs](#changelog)


## Introduction

zhuaxia(抓虾) (MIT Licensed) is a little tool to batch download music resources in multiple threads from www.xiami.com (in short `[xia]`) and music.163.com (in short `[163]`). 


**zhuaxia** was written and tested with:
- python 2.7.6


##Dependencies

- requests module
- mutagen module
- beautifulsoup4 module

##Features

- automatically recognize and parse URLs, so far it supports:
	- [xia] Song, Album, Collections, User Favorites, Artist TopN
	- [163] Song, Album, Playlist, Artist TopN
- artist Top N(configurable) Songs.([xia]max:20), default Top10. Configuration property: `download.artist.topsong` artist page url is needed
- download mixed urls in file. URLs can be mixed by [xia] and [163], also they can be different resource types (`-f` option)
- when download from file, multi-threading parsing the urls with a configurable thread pool
- multi-threading download with configurable thread pool.
- download HQ (320kbps) resources  (`-H` option)
- user friendly downloading progress display (colorful highlighting, adapt terminal width automatically, total progress, downloading thread progress...)
- mp3 renaming, mp3 meta data updating, auto-download album cover image. Album description(only[xia])...
- [xia]configuration property `xiami.proxy.http=ip:port` for xiami resource downloading via China proxy. Details："Usage -> [download xiami resource outside China](#proxy-setting)"
- `-p` option (experimental function)，using a proxypool to solve the problem of "ip was banned if requests to a server were too often.


##Installation

Archlinux user, zhuaxia can be found in AUR

Stable version (master branch):

	yaourt -S zhuaxia

latest git version (bleeding branch):

	yaourt -S zhuaxia-git

other users:

	sudo python setup.py install

## Usage

- configuration file: after first time running `zx`,  `zhuaxia.conf` will automatically generated under `$HOME/.zhuaxia/` check the comment in config file for details

- Usage:

		zhuaxia -- download mp3 music from [xiami.com] and [music.163.com]

		[CONFIG FILE:]   $HOME/.zhuaxia/zhuaxia.conf

		[OPTIONS]
			-H : prefer High Quality(320kbps),
				> xiami <
					- xiami vip user email/password should be set in config
					- user should set HQ on xiami vip setting page
					- if any above requirements was not satisfied, 128kbps will be taken
				> 163 <
					- no special requirement

			-p : auto choose proxy from proxy pool (experimental option)
				when frequency of request to target host is high enough, host could ban the client
				for some time. zhuaxia will auto take proxy from pool. However this may make
				downloading slow or unstable.

			-h ：show help
			-f ：download from url file
			-v ：show version information

		[USAGE]

			zx [OPTION] <URL>
				: auto recognize and download the given url resource, supports:
					- [xm] song, album, favorite, collection, artist TopN
					- [163]song, album, list, artist topN
				example:
					zx "http://www.xiami.com/space/lib-song/u/25531126"
					zx "http://music.163.com/song?id = 27552647"

			zx [OPTION] -f <file>
				: download from url file. one url per line. The urls could be 163 and xm mixed. Example:
				  $ cat /tmp/foo.txt
					http://music.163.com/artist?id=5345
					http://www.xiami.com/song/1772130322
					http://music.163.com/album?id=2635059
					http://www.xiami.com/album/32449

				  $ zx -f /tmp/foo.txt


### Proxy setting

**Download Xiami resources outside China**

xiami.com blocks http Requests from IP addresses outside China. In configuration file adding property (if it doesn't exist): `xiami.proxy.http=ip:port` can let zhuaxia download xiami resources via proxy.

For example:

	xiami.proxy.http=127.0.0.1:8080

The `ip:port` is http proxy in China, so that we can send request with Chinese IP. If your machine has already an IP in China. You don't need this option. You can remove or comment this property out.

**Tip**: finding a China proxy: Go to http://proxy-list.org/ then search country "China"

## Screenshots

- parsing and multi-thread downloading (gif animation)
![progress](https://raw.github.com/sk1418/sharedResources/master/zhuaxia/en_progress.gif)

- multi-thread parsing input file (gif animation)
![file view](https://raw.github.com/sk1418/sharedResources/master/zhuaxia/en_fileParse.gif)

- parse url
![url view](https://raw.github.com/sk1418/sharedResources/master/zhuaxia/en_urlParse.png)

## Changelog

[Click to check Change logs](CHANGELOG.txt)
